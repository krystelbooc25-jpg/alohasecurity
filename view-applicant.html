<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Applicant Details - Aloha Security</title>
    <link rel="stylesheet" href="view-applicant.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="container">
        <header class="page-header">
            <div class="header-left">
                <a href="dashboard.html" class="back-link"><i class="fas fa-arrow-left"></i> Dashboard</a>
                <h1>Applicant Profile</h1>
            </div>
            <button id="theme-toggle" class="theme-btn"><i id="theme-icon" class="fas fa-moon"></i></button>
        </header>

        <div class="applicant-card">
            <!-- Card Header: Profile Summary -->
            <div class="card-header">
                <div class="profile-info">
                    <div class="avatar"><i class="fas fa-user"></i></div>
                    <div class="name-box">
                        <h2 id="applicant-name">Loading...</h2>
                        <p id="applicant-position"><i class="fas fa-briefcase"></i> Loading position...</p>
                        <p id="applicant-branch" class="branch-tag"><i class="fas fa-map-marker-alt"></i> Unassigned</p>
                    </div>
                </div>
                <div class="action-buttons">
                    <a id="download-resume-btn" href="#" target="_blank" class="btn btn-secondary"><i class="fas fa-file-download"></i> Resume</a>
                    <button id="email-applicant-btn" class="btn btn-primary"><i class="fas fa-paper-plane"></i> Send Email</button>
                </div>
            </div>

            <!-- Card Body: Full Details -->
            <div class="card-body">
                <div class="detail-section">
                    <h3><i class="fas fa-id-card"></i> Personal Information</h3>
                    <div class="grid-layout">
                        <div class="info-item"><label>Email</label><p id="applicant-email">-</p></div>
                        <div class="info-item"><label>Phone</label><p id="applicant-phone">-</p></div>
                        <div class="info-item"><label>Address</label><p id="applicant-address">-</p></div>
                        <div class="info-item"><label>Date of Birth</label><p id="applicant-dob">-</p></div>
                    </div>
                </div>

                <div class="detail-section">
                    <h3><i class="fas fa-clipboard-check"></i> Position & Availability</h3>
                    <div class="grid-layout">
                        <div class="info-item"><label>Availability</label><p id="applicant-availability">-</p></div>
                        <div class="info-item"><label>Start Date</label><p id="applicant-start-date">-</p></div>
                        <div class="info-item"><label>Desired Salary</label><p id="applicant-salary">-</p></div>
                        <div class="info-item"><label>ID Provided</label><p id="applicant-id-type">-</p></div>
                    </div>
                </div>

                <div class="detail-section">
                    <h3><i class="fas fa-history"></i> Experience & Background</h3>
                    <div class="text-block">
                        <label>Security Experience</label>
                        <pre id="applicant-experience">No experience listed.</pre>
                    </div>
                    <div class="text-block">
                        <label>Education</label>
                        <pre id="applicant-education">No education details.</pre>
                    </div>
                    <div class="text-block">
                        <label>References</label>
                        <pre id="applicant-references">No references provided.</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

   <script>
        const supabaseUrl = 'https://kkaelwhdcsgaodbhrxqt.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtrYWVsd2hkY3NnYW9kYmhyeHF0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxOTA4NzksImV4cCI6MjA3MTc2Njg3OX0.wSFv1AZgZDXjGHiIwOHyWzqTDk0v6NbR4-2r90iF9ok';
        const _supabase = supabase.createClient(supabaseUrl, supabaseKey);

        // --- THEME LOGIC ---
        const themeBtn = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon');
        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-mode');
            themeIcon.classList.replace('fa-moon', 'fa-sun');
        }
        themeBtn.onclick = () => {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            isDark ? themeIcon.classList.replace('fa-moon', 'fa-sun') : themeIcon.classList.replace('fa-sun', 'fa-moon');
        };

        async function loadApplicantDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const applicantId = urlParams.get('id');
            if (!applicantId) return;

            const { data: app, error } = await _supabase.from('applicants').select('*').eq('id', applicantId).single();
            
            if (error || !app) {
                alert("Error: Applicant not found.");
                window.location.href = 'dashboard.html';
                return;
            }

            const or_na = (text) => text || 'N/A';
            
            // Populate Fields
            document.getElementById('applicant-name').textContent = `${or_na(app.first_name)} ${or_na(app.last_name)}`;
            document.getElementById('applicant-position').innerHTML = `<i class="fas fa-briefcase"></i> ${or_na(app.desired_position)}`;
            document.getElementById('applicant-branch').innerHTML = `<i class="fas fa-map-marker-alt"></i> ${or_na(app.assigned_branch)}`;
            document.getElementById('applicant-email').textContent = or_na(app.email);
            document.getElementById('applicant-phone').textContent = or_na(app.phone);
            document.getElementById('applicant-address').textContent = `${or_na(app.street_address)}, ${or_na(app.city)}`;
            document.getElementById('applicant-dob').textContent = or_na(app.dob);
            document.getElementById('applicant-availability').textContent = or_na(app.availability);
            document.getElementById('applicant-start-date').textContent = or_na(app.start_date);
            document.getElementById('applicant-salary').textContent = or_na(app.salary_range);
            document.getElementById('applicant-id-type').textContent = or_na(app.id_type);
            document.getElementById('applicant-experience').textContent = or_na(app.security_experience);
            document.getElementById('applicant-education').textContent = or_na(app.education_background);
            document.getElementById('applicant-references').textContent = or_na(app.references);

            // Resume Button
            const resumeBtn = document.getElementById('download-resume-btn');
            if (app.resume_url) resumeBtn.href = app.resume_url;
            else resumeBtn.style.display = 'none';

            // Email Button
            document.getElementById('email-applicant-btn').onclick = () => {
                window.location.href = `mailto:${app.email}?subject=Job Application Update - Aloha Security`;
            };
        }

        document.addEventListener('DOMContentLoaded', loadApplicantDetails);
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Applicant Portal - Aloha Security Agency</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary-red: #D2042D;
            --dark-blue: #002b5c;
            --bg-gray: #f4f7f9;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg-gray); margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        
        .portal-container { background: white; width: 90%; max-width: 450px; padding: 40px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); border-top: 5px solid var(--primary-red); }
        .logo-area { text-align: center; margin-bottom: 30px; }
        .logo-area h2 { color: var(--dark-blue); margin: 5px 0; }
        
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #444; }
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        
        .btn-check { width: 100%; padding: 14px; background: var(--primary-red); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 16px; transition: 0.3s; }
        .btn-check:hover { background: #a50323; }

        /* Status Result Styles */
        #status-result { display: none; text-align: center; }
        .status-badge { display: inline-block; padding: 10px 20px; border-radius: 50px; font-weight: bold; text-transform: uppercase; margin: 15px 0; }
        .pending { background: #fff4e5; color: #d48806; }
        .approved { background: #e6f7ff; color: #1890ff; }
        .rejected { background: #fff1f0; color: #f5222d; }
        
        .info-card { background: #f9f9f9; padding: 15px; border-radius: 8px; text-align: left; margin-top: 20px; border-left: 4px solid #ddd; }
        .notice { font-size: 13px; color: #777; margin-top: 20px; line-height: 1.4; }
        .back-link { display: block; margin-top: 20px; color: var(--dark-blue); text-decoration: none; font-size: 14px; }
    </style>
</head>
<body>

    <div class="portal-container">
        <!-- LOGIN SECTION -->
        <div id="login-section">
            <div class="logo-area">
                <i class="fas fa-shield-alt" style="font-size: 40px; color: var(--primary-red);"></i>
                <h2>Application Status</h2>
                <p>Enter your details to track your application.</p>
            </div>
            
            <div class="form-group">
                <label>Email Address</label>
                <input type="email" id="search-email" placeholder="email@example.com">
            </div>
            <div class="form-group">
                <label>Date of Birth</label>
                <input type="date" id="search-dob">
            </div>
            <button class="btn-check" onclick="checkStatus()">Track Application</button>
            <a href="index.html" class="back-link"><i class="fas fa-arrow-left"></i> Back to Home</a>
        </div>

        <!-- RESULT SECTION -->
        <div id="status-result">
            <h3 id="res-name">Hello, Applicant!</h3>
            <p>Your current application status is:</p>
            <div id="res-status" class="status-badge">PENDING</div>
            
            <div class="info-card">
                <p><strong>Position:</strong> <span id="res-position">Security Guard</span></p>
                <p id="deployment-info"><strong>Deployment:</strong> <span id="res-branch">Not yet assigned</span></p>
            </div>

            <p class="notice">
                <i class="fas fa-info-circle"></i> <strong>Note:</strong> You cannot edit your application once submitted. If you need to update your info, please contact Aloha Security HR.
            </p>
            
            <button class="btn-check" style="background: #555;" onclick="location.reload()">Back</button>
        </div>
    </div>

    <script>
        const supabaseUrl = 'https://kkaelwhdcsgaodbhrxqt.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtrYWVsd2hkY3NnYW9kYmhyeHF0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxOTA4NzksImV4cCI6MjA3MTc2Njg3OX0.wSFv1AZgZDXjGHiIwOHyWzqTDk0v6NbR4-2r90iF9ok';
        const _supabase = supabase.createClient(supabaseUrl, supabaseKey);

        async function checkStatus() {
            const email = document.getElementById('search-email').value;
            const dob = document.getElementById('search-dob').value;

            if(!email || !dob) return alert("Please fill in both fields.");

            const { data, error } = await _supabase
                .from('applicants')
                .select('*')
                .eq('email', email)
                .eq('dob', dob)
                .single();

            if (error || !data) {
                alert("No application found with those details. Please check your info or re-apply.");
                return;
            }

            // Populate Result
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('status-result').style.display = 'block';
            
            document.getElementById('res-name').innerText = `Hello, ${data.first_name}!`;
            document.getElementById('res-position').innerText = data.desired_position;
            
            const statusBox = document.getElementById('res-status');
            statusBox.innerText = data.status;
            statusBox.className = 'status-badge ' + data.status.toLowerCase();

            if(data.status === 'Approved' && data.assigned_branch) {
                document.getElementById('res-branch').innerText = data.assigned_branch;
                document.getElementById('deployment-info').style.display = 'block';
            } else {
                document.getElementById('deployment-info').style.display = 'none';
            }
        }
    </script>
</body>
</html>